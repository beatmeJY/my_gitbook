# Spring JPA

## Spring JPA

### JPA란?

* Java Persistence API 로써 자바의 객체와 관계형 데이터베이스 테이블 매핑을 함으로써 객체지향 프로그래밍의 장점을 살려 데이터베이스와의 상호작용을 하기 위한 API라 볼 수 있습니다.
* 이는 ORM 기술을 사용하여 데이터베이스의 데이터를 자바 객체로 변환하고, 자바 객체로 데이터베이스에 저장하거나 수정하는 등의 작업들을 수행할 수 있게 됩니다.



### 하이버네이트란?

* 자바에서 사용되는JPA의 표준 규격을 따라 만든 ORM 프레임워크 중 하나 입니다.



### Query Creation이란?

```java
public interface StudyRepository extends JpaRepository<Study, Long> {
    Study findByIdAndCreatedBy(Long id, Long createdBy);
}
```

* Spring JPA는 내부적으로 메서드 이름을 정규식으로 읽어서 이름을 적절히 분석하여 Query로 만들어 준다.
* Spring Data의 공식 문서에 따르면 아래 사진과 같은 Keyword 로 인식할 수 있다.

<figure><img src="../../.gitbook/assets/image (1) (1) (1).png" alt=""><figcaption><p><a href="https://docs.spring.io/spring-data/jpa/reference/jpa/query-methods.html">https://docs.spring.io/spring-data/jpa/reference/jpa/query-methods.html</a></p></figcaption></figure>



### SQL Mapper와 ORM 차이

* SQL Mapper의 경우 직접 SQL을 작성하여 데이터베이스와 상호 작용을 하는데, 이는 직접 객체와 객체간에 관계를 직접 설정해주어야 하고 데이터베이스의 SQL 쿼리를 직접 작성하기 때문에 추후 데이터 베이스가 변경 되게 되면 쿼리를 직접 다시 수정하여야 합니다.
* 하지만 ORM의 경우 데이터베이스와 객체 간에 매핑을 자동으로 해주기 때문에 사용자는 객체를 변경함 으로써 데이터베이스와 상호 작용을 할 수 있고, 이는 간단한 쿼리 등은 ORM이 직접 생성하여 주기 때문에 코드의 중복도 줄일 수 있고 추후 데이터베이스가 변경되더라도 사용자 코드는 변경 없이 ORM이 자동으로 변경된 데이터베이스의 쿼리를 생성할 수 있게 됩니다.



### DAO와 Repository 차이

* DAO 는 데이터베이스 직접적인 상호작용을 하기위해 사용되는 목적이 있고,
* Repository는 도메인 계층과 영속성 계층의 결합도를 줄이기 위해 데이터베이스 접근 로직을 추상화하고 캡슐화 하여 영속화된 객체들을 관리하고 도메인 계층에 필요한 데이터를 제공하는 목적이 있습니다.



### N+1이 발생하는 이유





### N+1 해결방법



### 양방향 vs 단방향 매핑

#### 양방향 매핑

* 장점
  * 코드 단에서 양방향 객체 간 관계를 쉽게 다룰 수 있습니다.
  * 조회가 많이 필요한 테이블에서는 불필요한 쿼리를 피하고 효율적으로 데이터를 사용 할 수 있습니다.
* 단점
  * EAGER 로딩은 필요 없는 경우에도 항상 자식 데이터까지 모두 가져오므로 사실 상 사용할 수 없습니다.
  * 매번 스터디카페 테이블에서 자식 데이터를 참조 할 경우 Lazy로딩으로 인한 추가 쿼리와 N+1문제로 인한 성능 이슈도 발생합니다.
  * 사실상 위의 문제를 해결하기 위해선 fetch join 등 추가로 쿼리를 작성하여 해결해야 합니다.
  * 코드의 복잡성이 증가하게 됩니다.

### 단방향 매핑

* 장점
  * DB에서 데이터를 가져올 경우 해당 테이블의 데이터만 가져 올 수 있어 부하가 적게 됩니다.
  * 스터디카페 테이블에서 자식 테이블의 정보가 필요한 경우에만 Fetch Join 쿼리를 사용하여 가져오면 되므로 다양한 상황에서 성능적으로 이점이 있습니다.
  * 코드의 복잡성이 줄어듭니다.
* 단점
  * 엔티티 객체가 반대 방향을 알지 못하기 때문에 필요 시에는 꼭 패치 조인 등 추가 쿼리를 작성하여 사용해야 합니다.



### DTO 를 왜 사용할까요?

* 추후 보완 예정.

### DAO와 Repository의 차이점은?

* 추후 보완 예정.
